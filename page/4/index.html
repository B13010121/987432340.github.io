<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  


<link rel="stylesheet" type="text/css" href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" />

<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.2"/>




  <meta name="keywords" content="Hexo,next" />





  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />


<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Lnju's notepad">
<meta property="og:url" content="http://www.plaype.cc/page/4/index.html">
<meta property="og:site_name" content="Lnju's notepad">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lnju's notepad">
<meta name="twitter:description">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post'
  };
</script>



  <title> Lnju's notepad </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lnju's notepad</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">一棵树，最好的时间是10年前，其次是现在</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/移动安全/2015-01-24-NDK开发初体验/2015-01-24.html" itemprop="url">
                  NDK开发初体验
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-01-24T00:00:00+08:00" content="2015-01-24">
              2015-01-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/移动安全/" itemprop="url" rel="index">
                    <span itemprop="name">移动安全</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>1.下载NDK开发工具包(android-ndk-r9-windows-x86.zip)，解压至某一文件夹（我这里是 <strong>D:\Coding\Java</strong>），将NDK的路径（我这里是 <strong>D:\Coding\Java\android-ndk-r9</strong>）放入系统环境变量的path路径中。检验是否成功的方法：打开CMD窗口，输入命令 <strong>ndk-build</strong> 看是否有一下的回显，若有，则是配置正确。</p>
<blockquote>
<p>Android NDK: Could not find application project directory !<br>Android NDK: Please define the NDK_PROJECT_PATH variable to point to it.<br>D:\Coding\Java\android-ndk-r9\build/core/build-local.mk:130: <em>*</em> Android NDK: Ab<br>orting    .  Stop.  </p>
</blockquote>
<p>2.在NDK的开发包中有实例代码可以供我们学习，打开Eclipse，文件 - 导入 -展开Android - Existing Android Code…… - Next， Brose 选择路径(我这里是 D:\Coding\Java\android-ndk-r9\samples\hello-jni),然后会出现两个项目，暂时只选择第一个项目（如图），点确定。<br><img src="http://i.imgur.com/GDZWzrn.png" alt=""></p>
<p>3.编译并运行这个项目。编译过程参考<a href="http://www.cnblogs.com/skyseraph/p/3979238.html" target="_blank" rel="external">链接</a> 的第二种方法即可成功编译</p>
<p>4.可以把编译好的程序安装运行。</p>
<p>5.也可以编译一个c/c++的程序（无界面）到手机中进行运行</p>
<p>6.JAVA代码的分析</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span>
</span>{
    TextView  tv = <span class="keyword">new</span> TextView(<span class="keyword">this</span>);
    tv.setText( stringFromJNI() ); <span class="comment">//返回so中函数执行的后返回值</span>
    setContentView(tv);
}
<span class="keyword">public</span> <span class="keyword">native</span> <span class="function">String  <span class="title">stringFromJNI</span><span class="params">()</span></span>; <span class="comment">//申明这是一个JNI的函数</span>

<span class="keyword">public</span> <span class="keyword">native</span> <span class="function">String  <span class="title">unimplementedStringFromJNI</span><span class="params">()</span></span>;
<span class="keyword">static</span> {
    System.loadLibrary(<span class="string">"hello-jni"</span>); <span class="comment">//访问到.C编译后的so库</span>
}
</code></pre><p>7.C代码的分析</p>
<pre><code>jstring
Java_com_example_hellojni_HelloJni_stringFromJNI( JNIEnv* env,
                                                  jobject thiz )
{
    <span class="keyword">return</span> <span class="function"><span class="params">(*env)</span>-&gt;</span>NewStringUTF(env, <span class="string">"Hello from JNI !"</span>);
}
</code></pre>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/编程/2015-01-01-多态代码除体验与瞎掰/2015-01-01.html" itemprop="url">
                  多态代码除体验与瞎掰
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-01-01T00:00:00+08:00" content="2015-01-01">
              2015-01-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程/" itemprop="url" rel="index">
                    <span itemprop="name">编程</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>从一本经典的病毒书上找到了两个经典的（最早出现能有代表意义的）多态的代码的demo。可以看到在还是16位字长的机器上就出现了多态，并且一直到今天还有很多壳在使用。不得不说多态是对逆向分析有不小的影响，在看到膨胀了许多无效代码，会导致对一个代码块的分析过程中瞻前顾不得后（因为有无效的值一直在运算，有效的信息位置间距较远），导致分析的速度变慢。</p>
<p>所以可以有下面2个学习方向：</p>
<ul>
<li>学习如何将多态代码能清除了，只留下 <code>有效</code>代码</li>
<li>学习如何写生成多态的代码</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">; Group 1 &#8211; Prolog(&#24320;&#22330;&#30333;;&#38138;&#22443;) Instructions &#10;inc     si    ; optional, variable junk&#10;mov     ax,0E9B    ; set key 1&#10;clc    ; optional, variable junk&#10;mov     di,012A    ; offset of Start&#10;nop    ; optional, variable junk&#10;mov     cx,0571    ; this many bytes - key 2&#10;&#10;; Group 2 &#8211; Decryption Instructions&#10;Decrypt:&#10;xor     [di],cx    ; decrypt first word with key 2&#10;sub     bx,dx    ; optional, variable junk&#10;xor     bx,cx    ; optional, variable junk&#10;sub     bx,ax    ; optional, variable junk&#10;sub     bx,cx    ; optional, variable junk&#10;nop    ; non-optional junk&#10;xor     dx,cx    ; optional, variable junk&#10;xor     [di],ax    ; decrypt first word with key 1&#10;; Group 3 &#8211; Decryption Instructions&#10;inc     di    ; next byte&#10;nop    ; non-optional junk&#10;clc    ; optional, variable junk&#10;inc     ax    ; slide key 1&#10;; loop&#10;loop    Decrypt    ; until all bytes are decrypted &#8211; slide key 2&#10;; random padding up to 39 bytes</span><br></pre></td></tr></table></figure>
<p>第二段多态代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start:&#10;;     Encrypted/decrypted virus body&#10;    ; to &#34;Start&#34;-delta&#65288;&#19977;&#35282;&#27954;&#65289;&#22312;&#36825;&#20799;&#26159;&#21152;&#23494;&#21518;&#30340;&#20195;&#30721;&#21306;&#22495;&#30340;&#24847;&#24605;&#10;mov     cl,03    ; (delta is 0x0D2B in this example)&#10;ror     bp,cl&#10;mov     cx,bp&#10;mov     bp,856E&#10;or      bp,740F&#10;mov     si,bp&#10;mov     bp,3B92&#10;add     bp,si&#10;xor     bp,cx&#10;sub     bp,B10C    ; Huh ... finally BP is set, but remains an&#10;     ; obfuscated pointer to encrypted body&#10;&#10;Decrypt:&#10;mov     bx,[bp+0D2B]    ; pick next word&#10;     ; (first time at &#34;Start&#34;)&#10;add     bx,9D64    ; decrypt it&#10;xchg    [bp+0D2B],bx    ; put decrypted value to place&#10;&#10;mov     bx,8F31    ; this block increments BP by 2&#10;sub     bx,bp&#10;mov     bp,8F33&#10;sub     bp,bx    ; and controls the length of decryption</span><br></pre></td></tr></table></figure>
<p>利用数学膨胀代码，使得bx参与了和bp的运算，实际上又是无意义的，等价于</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov     bx,8F31    ; this block increments BP by 2&#10;sub     bx,bp&#10;mov     bp,8F33&#10;sub     bp,bx    ; and controls the length of decryption</span><br></pre></td></tr></table></figure>
<p>关于清除多态代码的一点点想法（瞎掰）：</p>
<ol>
<li>清除的思路是什么？<br>设计一个程序 clear，功能定位是给定一个程序，自动分析代码，若有junk code则自动清除，可以将junk code直接帮助我nop掉，这样分析起来看起来很轻松了。那么程序的输入就是指定一个exe程序，输出就是一个nop掉垃圾代码的程序。</li>
<li>程序的模块分析：<ol>
<li>反汇编模块，想要分析一个程序（二进制代码），必须借助反汇编模块将二进制代码分析出来类似OD中我们能看到的那样，让clear也能获得反汇编结构</li>
<li>调试模块：模仿人的思维，单步调试程序，把所有寄存器的初始值记录下来，每走一步标记寄存器值改变了的寄存器（添加对于每个寄存器来说值改变时的地址，比如1  mov eax,1;2 mov eax,2 3 mov eax,3 则记录 1 2 3 ），发现在地址1到地址3之间寄存器eax并没有作为源操作数，那么在地址3之前的对eax赋值、运算的操作都可以视为“无效”。</li>
</ol>
</li>
<li>静态分析模块：实际上是对2的改进，不一定要做一个调试器，做一个语意的规则也可以，把所有的汇编指令分门别类做成一张表，哪些指令是改变了源操作数，哪些改变了目的操作数，哪些是影响了标志位的改变…… 在实际静态分析的时候，都可以把这些汇编指令产生的影响直接记录下来就可以了。</li>
<li>简略的算法描述：跟踪所有寄存器，以eax为例，在addr＝ xxxxxxxx 寄存器的值被改变（或给其他值赋值了）的时候记下addr，若跟踪到下一次eax的值在addr ＝ yyyyyyyy 被改变时，查看记录的addr ＝ xxxxxxxx到yyyyyyyy之间有无作为源操作数赋值的行为，若没有，则将两次之间的eax的被赋值的操作全部以90 nop掉。</li>
<li>算法的依据：在把寄存器作为junk code时，实际上是以当前寄存器作临时变量作为代价的，若是后续还要用到这个寄存器，那么总有一个时刻，会对寄存器赋值一个有效值，并且参与真正的运算。</li>
</ol>
<p>关于生成多态代码的一点点想法（瞎掰）：</p>
<ol>
<li>确定一个范围：要生成多态代码，必须在一定范围内，分析一些暂时用不到的寄存器（最好是不用保存再还原值的那种），将这些寄存器可以好好利用：赋值操作，移位操作，还有各种运算。  </li>
<li>要做到混乱无章的效果，要有一个生成多态的多态模板：每次从模板随机中抽取几个代码做为成生成的代码，然后根据实际有哪些寄存器不用，跟换寄存器的名称即可。</li>
<li>获取模板的方法：多分析别人的壳，获取到多态的模板函数，应用到自己的模板规则中来。</li>
</ol>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/逆向分析/2014-12-31-反汇编库udis86的使用/2014-12-31.html" itemprop="url">
                  反汇编库udis86的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-12-31T00:00:00+08:00" content="2014-12-31">
              2014-12-31
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/逆向分析/" itemprop="url" rel="index">
                    <span itemprop="name">逆向分析</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>##解决2个BUG</p>
<p><a href="https://github.com/vmt/udis86" target="_blank" rel="external">GitHub项目地址</a>，下载的是源代码，需要自己手动编译。百度了一下发现给出的帮助都是关于gcc下的，给跪了，叫我等常年使用VC6.0的情何以堪。</p>
<p>再去git上查看，找到了在windows平台上使用的相关介绍:</p>
<blockquote>
<p>Build notes for Windows:<br>– If you don’t have python installed at C:\Python27, edit build.proj accordingly<br>– Execute buildVS2010.bat<br>– If you got VS2012, this will fail.<br>– Edit/Copy the build script, so that it finds vcvars32.bat (just needed to replace 10.0 with 11.0).<br>– Open the solution and update the toolset.<br>– Compile with the build script and ignore an error regarding ./Win32 not deletable.<br>– Be done with it  </p>
</blockquote>
<p>按照默认的操作：在pyhon2.7的环境下，安装vs2010，执行.bat，可是直接执行出现错误，一开始怀疑自己的python是不是版本不对，查看了一下是32位的python2.7，而VS是刚刚安装好的，应该不会有什么问题……    </p>
<p>这时候打开 <code>buildVS2010.bat</code>,查看，发现作者把VS2010的路径写死在了C盘的默认路径上，像我一样不喜欢把程序安装在C盘上的人是不是都一样蛋疼啊！<br>再次执行，依然不对，bat文件中使用了 <code>build.proj</code> 文件，再打开查看，修改python的路径指向自己电脑的python路径，再次执行，终于成功了! 这样就多了一些 <code>.h</code>头文件出来。<br>接着，执行BuildVS2010\libudis86项目文件，然后编译生成一个udis86.lib文件。<br>再然后，将lib文件复制到VS2010安装目录的lib文件夹中，将udis86.h文件复制到VS2010安装目录的include文件夹中，下次使用以下代码即可使用udis86这个库:  </p>
<h2 id="<!-￼0->"><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;udis86.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> comment(lib,”udis86.lib”)</span></span><br></pre></td></tr></table></figure></h2><h2 id="反汇编demo_+_SDK解释">反汇编demo + SDK解释</h2><figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* simple_example.c */</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;udis86.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="keyword">ud_t</span> ud_obj;</span><br><span class="line">ud_init(&amp;ud_obj);</span><br><span class="line">ud_set_input_file(&amp;ud_obj, <span class="built_in">stdin</span>);</span><br><span class="line">ud_set_mode(&amp;ud_obj, <span class="number">64</span>);</span><br><span class="line">ud_set_syntax(&amp;ud_obj, UD_SYN_INTEL);</span><br><span class="line"><span class="keyword">while</span> (ud_disassemble(&amp;ud_obj)) &#123;</span><br><span class="line"><span class="built_in">printf</span>(“\t%s\n”, ud_insn_asm(&amp;ud_obj));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可供利用的函数详解：<br>0x1</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ud_t 对象的初始化，在使用前必须初始化</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ud_init</span> <span class="params">(ud_t* ud_obj)</span></span></span><br></pre></td></tr></table></figure>
<p>0x2  </p>
<figure class="highlight"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//貌似是把input的数据直接转交给hook函数处理 </span><br><span class="line">void ud_set_input_hook(ud_t* ud_obj, int (*hook)())</span><br><span class="line"></span><br><span class="line">//This function sets the input source for the library. To retrieve each byte in the stream,</span><br><span class="line">//libudis86 calls back the function pointed to by “hook”. The hook function, defined by the</span><br><span class="line">//user code, must return a single byte of code each time it is called. To signal end-ofinput,</span><br><span class="line">//it must return the constant, UD_EOI.</span><br></pre></td></tr></table></figure>
<p>0x3</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置反编译的字节码在缓冲区中，需要给出缓冲区的大小</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ud_set_input_buffer</span><span class="params">(ud_t* ud_obj, <span class="keyword">unsigned</span> <span class="keyword">char</span>* buffer, size_t size)</span></span>;</span><br></pre></td></tr></table></figure>
<p>0x4</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置反编译的字节码在文件中，给出文件指针</span></span><br><span class="line"><span class="comment">//Tips: 需要自己先检查文件指针的有效性</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ud_set_input_file</span><span class="params">(ud_t* ud_obj, FILE* filep)</span></span>;</span><br></pre></td></tr></table></figure>
<p>0x5</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置反编译的模式有16/32/64位3种可选</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ud_set_mode</span><span class="params">(ud_t* ud_obj, uint8_t mode_bits)</span></span>;</span><br></pre></td></tr></table></figure>
<p>0x6</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置反编译字节码的EIP/RIP 影响到汇编代码的偏移地址</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ud_set_pc</span><span class="params">(ud_t*, uint64_t pc)</span></span>;</span><br></pre></td></tr></table></figure>
<p>0x7</p>
<figure class="highlight"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//设置汇编语言的语法 可选有UD_SYN_INTEL（MS） UD_SYN_ATT（linux）</span><br><span class="line">void ud_set_syntax(ud_t*, void (*translator)(ud_t*));</span><br></pre></td></tr></table></figure>
<p>0x8</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置CPU的类型 UD_VENDOR_INTEL（INTEL）UD_VEDNOR_ATT（AMD）</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ud_set_vendor</span><span class="params">(ud_t*, <span class="keyword">unsigned</span> vendor)</span></span>;</span><br></pre></td></tr></table></figure>
<p>0x9</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在输入的字节码中反汇编下一条汇编指令，返回被反汇编的字节数。0表示反汇编到结束</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">ud_disassemble</span><span class="params">(ud_t*)</span></span>;</span><br></pre></td></tr></table></figure>
<p>0xA</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回反汇编的字节数</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">ud_insn_len</span><span class="params">(ud_t* u)</span></span>;</span><br></pre></td></tr></table></figure>
<p>0xB</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回指令的偏移相对于开始的地址</span></span><br><span class="line"><span class="keyword">uint64_t</span> ud_insn_off(<span class="keyword">ud_t</span>*);</span><br></pre></td></tr></table></figure>
<p>0xC</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回的char指针 指示了被反汇编的字节</span></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">ud_insn_hex</span><span class="params">(ud_t*)</span></span>;</span><br></pre></td></tr></table></figure>
<p>0xD</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回在buffer中的指针，为了使用e ud_insn_len()函数</span></span><br><span class="line"><span class="keyword">uint8_t</span>* ud_insn_ptr(<span class="keyword">ud_t</span>* u);</span><br></pre></td></tr></table></figure>
<p>0xE</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回汇编代码，而不是opcode</span></span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">ud_insn_asm</span><span class="params">(ud_t* u)</span></span></span><br></pre></td></tr></table></figure>
<p>0xF</p>
<figure class="highlight c"><figcaption><span>++</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//跳过N个字节的指令</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ud_input_skip</span><span class="params">(ud_t*, size_t n)</span></span>;</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>


 </div>

        

        
      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Lnju" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Lnju</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">7</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">10</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lnju</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.2" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }

      motionIntegrator.bootstrap();
    });
  </script>

  
  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
